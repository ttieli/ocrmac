# 给测试者的说明

你好！这个 PR 添加了 OCR 升级功能（表格恢复 + 文章分段）。

---

## 🚀 快速测试（5 分钟）

### 1. 环境准备

**必须在 macOS 上测试**（依赖 Apple Vision/LiveText）

```bash
# 检查系统
sw_vers  # 确认是 macOS

# 克隆并切换分支
git clone https://github.com/ttieli/ocrmac.git
cd ocrmac
git checkout claude/ocr-table-recovery-upgrade-aPKL7

# 安装
pip install -e .
```

---

### 2. 准备测试图片

**最简单方式**：用 Excel 做个表格，截图

```bash
# 创建目录
mkdir -p tests/test_images

# 把你的测试图片放进去（至少 2 张）：
# - table.png         （必需）一个 2x2 或 3x3 的表格
# - simple_text.png   （可选）几行纯文本
```

**示例表格**（复制到 Excel，截图保存为 `table.png`）：
```
姓名    年龄    城市
张三    25      北京
李四    30      上海
```

---

### 3. 运行测试

```bash
cd tests
python3 test_end_to_end.py
```

**如果没有图片**，可以先生成示例：
```bash
python3 generate_test_images.py
python3 test_end_to_end.py
```

---

### 4. 预期结果

看到这样的输出就是成功：

```
🚀 OCR 升级功能端到端测试
============================================================

测试 2: 表格识别和恢复
============================================================
📸 正在识别: table.png
✅ OCR 完成，共识别 9 个文本块
🔍 正在检测表格结构...
✅ 检测到表格: 3 行 x 3 列

生成的 Markdown 表格:
------------------------------------------------------------
| 姓名 | 年龄 | 城市 |
| --- | --- | --- |
| 张三 | 25 | 北京 |
| 李四 | 30 | 上海 |
------------------------------------------------------------

...

============================================================
📊 测试结果总结
============================================================
✅ 通过  简单文本识别
✅ 通过  表格识别和恢复
...
总计: X/5 通过

🎉 所有测试通过！
```

**关键指标**：
- ✅ 能检测到表格（几行几列）
- ✅ 能输出 Markdown 表格
- ✅ 单元格内容准确

---

## 🔍 手动快速验证

如果不想跑完整测试，可以单独测试表格功能：

```bash
python3 << 'EOF'
from ocrmac import OCR
from ocrmac.table_recovery import TableDetector

# OCR 识别
ocr = OCR('tests/test_images/table.png', framework='livetext', unit='line')
results = ocr.recognize()

print(f"✅ OCR 识别了 {len(results)} 个文本块\n")

# 表格检测
detector = TableDetector()
table = detector.detect(results)

if table:
    print(f"✅ 检测到表格: {table.rows} 行 x {table.cols} 列\n")
    print(table.to_markdown())
else:
    print("❌ 未检测到表格")
EOF
```

---

## 📋 测试报告（反馈给我）

测试后请告诉我：

```markdown
**测试环境**:
- macOS 版本: ___________
- Python 版本: ___________

**测试结果**:
- [ ] 表格检测: ✅ 成功 / ❌ 失败
- [ ] 段落分析: ✅ 成功 / ❌ 失败（可选测试）

**备注**:
（如果失败，请说明情况）
```

---

## 🐛 如果表格检测失败

### 1. 检查 OCR 是否完整识别
```bash
python3 -c "
from ocrmac import OCR
ocr = OCR('tests/test_images/table.png', framework='livetext', unit='line')
results = ocr.recognize()
print(f'识别了 {len(results)} 个文本块:')
for text, conf, bbox in results:
    print(f'  - {text}')
"
```

如果文本块数量少于表格单元格数量，说明 OCR 遗漏了。

**解决方法**：
1. 表格字号调大（18pt+）
2. 确保表格清晰
3. 使用 Numbers/Excel 制作规整表格

### 2. 放宽检测参数

编辑 `tests/test_end_to_end.py`，找到第 72 行左右：
```python
detector = TableDetector(
    y_tolerance=0.015,    # 改为 0.03
    x_tolerance=0.025,    # 改为 0.05
)
```

---

## 📚 详细文档

如果你想深入了解：

- **快速测试**: `tests/README_TEST.md` （推荐先看）
- **详细指南**: `tests/TEST_GUIDE.md` （包含图片制作详细说明）
- **中文说明**: `测试说明.md`
- **使用示例**: `QUICKSTART.md`
- **技术方案**: `UPGRADE_PLAN.md`

---

## ✅ 测试通过后

如果测试没问题，可以：

1. **反馈测试报告**（简单说一下测试结果）
2. **合并到 main**：
   ```bash
   git checkout main
   git merge claude/ocr-table-recovery-upgrade-aPKL7
   git push
   ```

---

## 🙏 感谢

感谢你的测试！如果有任何问题或建议，请随时反馈。

---

**最简单的测试步骤**：

1. macOS 上克隆仓库
2. 用 Excel 做个表格截图 → `tests/test_images/table.png`
3. 运行 `python3 tests/test_end_to_end.py`
4. 看是否显示 "✅ 检测到表格"

就这么简单！😊

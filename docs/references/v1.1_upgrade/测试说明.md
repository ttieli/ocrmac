# 真实测试说明（macOS 必需）

## 🎯 测试内容

验证 OCR 升级功能：
1. ✅ 表格识别和恢复
2. ✅ 文章自动分段
3. ✅ 标题和列表识别
4. ✅ 结构化 Markdown 输出

---

## ⚡ 快速测试（3 分钟）

### 第 1 步：准备测试图片

**方式 A：自动生成**（快速但不够真实）
```bash
cd tests
python3 generate_test_images.py
```

**方式 B：手动准备**（推荐）

创建 5 张简单图片，放入 `tests/test_images/` 目录：

| 图片 | 内容 | 如何制作 |
|------|------|----------|
| **simple_text.png** | 3 行纯文本 | 打开备忘录，输入 3 行，截图 |
| **table.png** | 2x2 表格 | Excel 做个表格，截图 |
| **multi_paragraph.png** | 3 段文字 | 备忘录，段落间空行，截图 |
| **heading_list.png** | 标题+列表 | 标题用大字号，列表用 •，截图 |
| **mixed_content.png** | 混合内容 | 可选 |

**示例表格**（复制到 Excel，截图即可）：
```
姓名    年龄    城市
张三    25      北京
李四    30      上海
```

---

### 第 2 步：运行测试

```bash
cd tests
python3 test_end_to_end.py
```

**预期输出**：
```
🚀 OCR 升级功能端到端测试
...
============================================================
📊 测试结果总结
============================================================
✅ 通过  简单文本识别
✅ 通过  表格识别和恢复
✅ 通过  多段落文档分析
✅ 通过  标题和列表识别
✅ 通过  混合内容
------------------------------------------------------------
总计: 5/5 通过

🎉 所有测试通过！
```

如果看到 **5/5 通过**，说明功能正常！✅

---

## 🔍 单独测试某个功能

### 快速测试表格识别
```bash
# 1. 准备一张表格图片 table.png

# 2. 运行
python3 << 'EOF'
from ocrmac import OCR
from ocrmac.table_recovery import TableDetector

ocr = OCR('tests/test_images/table.png', framework='livetext', unit='line')
results = ocr.recognize()

detector = TableDetector()
table = detector.detect(results)

if table:
    print("✅ 表格检测成功")
    print(table.to_markdown())
else:
    print("❌ 未检测到表格")
EOF
```

**预期输出**：
```
✅ 表格检测成功
| 姓名 | 年龄 | 城市 |
| --- | --- | --- |
| 张三 | 25 | 北京 |
| 李四 | 30 | 上海 |
```

---

### 快速测试段落分析
```bash
# 1. 准备一张多段落文档图片

# 2. 运行
python3 << 'EOF'
from ocrmac import OCR
from ocrmac.layout_analyzer import LayoutAnalyzer

ocr = OCR('tests/test_images/multi_paragraph.png', framework='livetext', unit='line')
results = ocr.recognize()

analyzer = LayoutAnalyzer()
layout = analyzer.analyze(results)

print(f"✅ 检测到 {len(layout['paragraphs'])} 个段落\n")
print(analyzer.to_markdown(layout))
EOF
```

---

## ⚠️ 注意事项

### 必须在 macOS 上运行
此测试依赖 Apple Vision/LiveText 框架，**只能在 Mac 上运行**。

如果不在 Mac 上运行，会看到：
```
❌ 当前系统不是 macOS
   检测到: linux
```

### 图片质量要求
- ✅ 清晰截图（不要拍照）
- ✅ 字号至少 18pt
- ✅ 表格对齐清晰
- ❌ 避免模糊、倾斜

---

## 🐛 常见问题

### ❓ 表格没检测到

**检查 1：OCR 识别是否完整**
```bash
python3 -c "
from ocrmac import OCR
ocr = OCR('tests/test_images/table.png', framework='livetext', unit='line')
results = ocr.recognize()
print(f'识别了 {len(results)} 个文本块')
for text, conf, bbox in results:
    print(f'  {text}')
"
```

如果文本块少于表格单元格数量，说明 OCR 识别遗漏了。

**解决方法**：
1. 确保表格清晰
2. 字号调大（至少 18pt）
3. 表格网格线清晰

**检查 2：放宽检测参数**

编辑 `tests/test_end_to_end.py`，找到：
```python
detector = TableDetector(
    y_tolerance=0.015,    # 改为 0.03
    x_tolerance=0.025,    # 改为 0.05
)
```

---

### ❓ 段落分段不准

调整阈值：
```python
analyzer = LayoutAnalyzer(
    line_spacing_threshold=2.0,  # 增大 → 分段更少
)
```

---

## 📋 测试报告模板

```markdown
## 测试环境
- macOS 版本: macOS 14.2 Sonoma
- Python 版本: 3.11.5
- 测试日期: 2026-01-XX

## 测试结果
✅ 简单文本识别 - 通过
✅ 表格识别 - 通过（3x3 表格完美识别）
✅ 多段落分析 - 通过（正确分 3 段）
✅ 标题和列表 - 通过
✅ 混合内容 - 通过

**总计**: 5/5 通过

## 备注
测试使用真实 Excel 截图，识别准确率很高。
```

---

## ✅ 测试完成后

如果测试通过：

1. ✅ 填写测试报告（可选）
2. 🔀 合并 PR：
   ```bash
   git checkout main
   git merge claude/ocr-table-recovery-upgrade-aPKL7
   git push
   ```
3. 🎉 开始使用新功能！

---

## 📚 详细文档

- **快速上手**: `QUICKSTART.md`
- **完整测试指南**: `tests/TEST_GUIDE.md`
- **技术方案**: `UPGRADE_PLAN.md`
- **项目总结**: `PROJECT_SUMMARY.md`

---

**有问题？** 查看 `tests/README_TEST.md` 或提交 Issue
